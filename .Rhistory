family = binomial(link = "log"),
start = c(log(mean(data[[dep_var]])), rep(0, n_coefs - 1))
), silent = TRUE)
# Apply appropriate variance-covariance estimation
if (!is.null(cluster_var)) {
# Use clustered standard errors if cluster variable is provided
robust_vcov <- vcovCL(model, cluster = data[[cluster_var]])
} else {
# Default to heteroskedasticity-robust standard errors if no cluster variable
robust_vcov <- vcovHC(model, type = "HC1")
}
# Return model with appropriate variance-covariance matrix
robust_model <- list(
model = model,
vcov = robust_vcov
)
return(robust_model)
}
#Load data
analysis_data <- readRDS(here("processed data", "analysis_data.RDS"))
#Validity----
library(haven)
qual_coding <- read_dta("C:/Users/Andre/Dropbox/Andrew and Brendan Shared Folder/PST Feedback Text/data/qual coding/Refl_CTO_response_analysis_07082024.dta") %>%
filter(!(nocriticism == 1 & (lessoncycle == 1 | lessonconnections == 1 | studentcomprehension == 1 | lessondelivery == 1 | praise == 1 | transitions == 1 | attention == 1 | nonverbaltechniques == 1 | corrections == 1)))
#Combine data sources----
qual_coding_lim <- select(qual_coding, observationid, crm, Codes1,
nocriticism, AcademicsCategory, BehaviorsCategory, lessoncycle,
lessonconnections, studentcomprehension, lessondelivery, praise, transitions,
attention, nonverbaltechniques, corrections)
matched_data <- inner_join(analysis_data, qual_coding_lim)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 2)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 2) %>%
select(text_feedback)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism + lessoncycle + lessonconnections + studentcomprehension + lessondelivery + praise + transitions + attention + nonverbaltechniques + corrections)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
select(row_number()==1)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==1)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==2)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==3)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==4)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==5)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==6)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, student_engagement_mentioned_feed, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==6)
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, lesson_planning_mentioned_feed, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==6)
#ReadMe----
#Purpose: Testing reliability and validity of coding
#Author: Andrew Avitabile
#General----
#Load packages
pacman::p_load(conflicted, here, tidyverse, fixest, modelsummary, tinytable, car, gtheory)
# Remove everything
rm(list=ls())
# Set output filepath - YOU'LL NEED TO UPDATE THIS
output_path <- "C:/Users/Andre/Dropbox/Apps/Overleaf/PST Feedback Text Analysis/figures_and_tables"
# Conflict prefer
conflict_prefer(name = "filter", winner = "dplyr")
# Outcome mean function
glance_custom.fixest <- function(x, ...) {
out <- data.frame("Mean(DV)" = as.numeric(fitstat(x, type = "my")))
return(out)
}
# Replace X with checkmark
replace_x_with_checkmark <- function(text) {
gsub("X", "$\\checkmark$", text, fixed = TRUE)
}
# Renaming goodness-of-fit statistics
gm <- tibble::tribble(
~raw,                ~clean,          ~fmt,
"nobs",               "\\midrule N",             0,
"r.squared",          "$R^2$",         3,
"Mean.DV.",           "Outcome Mean",  3,
"FE: programcohort",  "Program $\\times$ cohort FE", 0,
"FE: supervisor_id",  "Supervisor FE", 0,
"FE: pst_id",  "PST FE", 0,
"FE: observation_order", "Order FE", 0,
"FE: cohort_cl", "Cohort FE", 0)
# Define a function to fit clustered models
fit_clustered_model <- function(formula, data, cluster_var = NULL) {
# Convert the formula to a character string to analyze it
formula_str <- as.character(formula)
# Determine the dependent variable name
dep_var <- formula_str[2]
# Count the number of coefficients by creating a model matrix
model_matrix <- model.matrix(formula, data)
n_coefs <- ncol(model_matrix)
# Fit the model using glm with log link and appropriate starting values
model <- try(glm(
formula,
data = data,
family = binomial(link = "log"),
start = c(log(mean(data[[dep_var]])), rep(0, n_coefs - 1))
), silent = TRUE)
# Apply appropriate variance-covariance estimation
if (!is.null(cluster_var)) {
# Use clustered standard errors if cluster variable is provided
robust_vcov <- vcovCL(model, cluster = data[[cluster_var]])
} else {
# Default to heteroskedasticity-robust standard errors if no cluster variable
robust_vcov <- vcovHC(model, type = "HC1")
}
# Return model with appropriate variance-covariance matrix
robust_model <- list(
model = model,
vcov = robust_vcov
)
return(robust_model)
}
#Load data
analysis_data <- readRDS(here("processed data", "analysis_data.RDS"))
#Validity----
library(haven)
qual_coding <- read_dta("C:/Users/Andre/Dropbox/Andrew and Brendan Shared Folder/PST Feedback Text/data/qual coding/Refl_CTO_response_analysis_07082024.dta") %>%
filter(!(nocriticism == 1 & (lessoncycle == 1 | lessonconnections == 1 | studentcomprehension == 1 | lessondelivery == 1 | praise == 1 | transitions == 1 | attention == 1 | nonverbaltechniques == 1 | corrections == 1)))
#Combine data sources----
qual_coding_lim <- select(qual_coding, observationid, crm, Codes1,
nocriticism, AcademicsCategory, BehaviorsCategory, lessoncycle,
lessonconnections, studentcomprehension, lessondelivery, praise, transitions,
attention, nonverbaltechniques, corrections)
matched_data <- inner_join(analysis_data, qual_coding_lim)
# Example - humans fail to capture things!
matched_data %>%
filter(classroom_management_mentioned_feed==1 & n_sentences_feed == 3) %>%
select(text_feedback, classroom_management_mentioned_feed, nocriticism, lessoncycle, lessonconnections, studentcomprehension, lessondelivery, praise, transitions, attention, nonverbaltechniques, corrections) %>%
filter(row_number()==2)
analysis_data <- readRDS(here("processed data", "analysis_data.RDS"))
filter(analysis_data, specific_examples_feed==1 & area_for_improvement_feed==1 & next_steps_feed==1)
filter(analysis_data, specific_examples_feed==0 & area_for_improvement_feed==0 & next_steps_feed==0) %>%
select(text_feedback) %>%
sample_n(1)
filter(analysis_data, specific_examples_feed==0 & area_for_improvement_feed==0 & next_steps_feed==0)
filter(analysis_data, specific_examples_feed==0 & area_for_improvement_feed==0 & next_steps_feed==0) %>%
select(text_feedback)
filter(analysis_data, specific_examples_feed==0 & area_for_improvement_feed==0 & next_steps_feed==0) %>%
select(text_feedback) %>%
sample_n(size = 1)
filter(analysis_data, specific_examples_feed==0 & area_for_improvement_feed==0 & next_steps_feed==0) %>%
select(text_feedback)
analysis_data$specific_examples_feed
filter(analysis_data, area_for_improvement_feed==0 & next_steps_feed==0) %>%
select(text_feedback) %>%
sample_n(size = 1)
analysis_data$area_for_improvement_feed
filter(analysis_data, specific_examples_feed==0 & areas_for_growth_feed==0 & next_steps_feed==0) %>%
select(text_feedback) %>%
sample_n(size = 1)
# Example of "high-quality" feedback
filter(analysis_data, specific_examples_feed==1 & areas_for_growth_feed==1 & next_steps_feed==1) %>%
select(text_feedback) %>%
sample_n(1)
# Example of "high-quality" feedback
filter(analysis_data, specific_examples_feed==1 & areas_for_growth_feed==1 & next_steps_feed==1) %>%
select(text_feedback) %>%
sample_n(1)
filter(analysis_data, specific_examples_feed==0 & areas_for_growth_feed==0 & next_steps_feed==0) %>%
select(text_feedback) %>%
filter(text_feedback=="'s instructional skills in the classroom are good .   Growth in confidence and pacing has been seen .")
filter(analysis_data, specific_examples_feed==0 & areas_for_growth_feed==0 & next_steps_feed==0) %>%
# select(text_feedback) %>%
filter(text_feedback=="'s instructional skills in the classroom are good .   Growth in confidence and pacing has been seen .")
test <- filter(analysis_data, specific_examples_feed==0 & areas_for_growth_feed==0 & next_steps_feed==0) %>%
# select(text_feedback) %>%
filter(text_feedback=="'s instructional skills in the classroom are good .   Growth in confidence and pacing has been seen .")
test$area_for_improvement_feed
test$areas_for_growth_feed
test$strengths_mentioned_feed
filter(analysis_data, classroom_management_mentioned_feed==1) %>%
select(text_feedback) %>%
sample_n(1)
filter(analysis_data, classroom_management_mentioned_feed==1) %>%
select(text_feedback) %>%
sample_n(1)
filter(analysis_data, classroom_management_mentioned_feed==1) %>%
select(text_feedback) %>%
sample_n(1)
#ReadMe----
#Purpose: Generating plots for analysis
#Author: Andrew Avitabile
#General----
#Load packages
pacman::p_load(conflicted, here, tidyverse, showtext, scales)
# Remove everything
rm(list=ls())
# Conflict prefer
conflict_prefer(name = "filter", winner = "dplyr")
#Add fonts
font_add(family = "LMRoman", regular = here("lmroman10-regular.otf"))
showtext_auto()
# Set output filepath - YOU'LL NEED TO UPDATE THIS
output_path <- "C:/Users/Andre/Dropbox/Apps/Overleaf/PST Feedback Text Analysis/figures_and_tables"
#Load data
analysis_data <- readRDS(here("processed data", "analysis_data.RDS"))
plot_data <- analysis_data %>%
mutate(feedback_score = rowMeans(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed")), na.rm = TRUE)) %>%
mutate(feedback_score = rowMeans(across(c("no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref")), na.rm = TRUE)) %>%
filter(no_afi_mentioned_feed==0)
# Calculate overall means
overall_means <- plot_data %>%
summarize(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~mean(.x, na.rm = TRUE), .names = "overall_{.col}"))
# Calculate PST-level means (PSTs with at least one occurrence)
pst_means <- plot_data %>%
group_by(pst_id) %>%
summarize(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~as.numeric(any(.x == 1, na.rm = TRUE)))) %>%
summarize(across(-pst_id, ~mean(.x, na.rm = TRUE), .names = "pst_{.col}"))
# Combine and reshape data for plotting
plot_data_combined <- bind_rows(
pivot_longer(overall_means,
cols = everything(),
names_to = "Category",
values_to = "Mean") %>%
mutate(Type = "Observation-Level"),
pivot_longer(pst_means,
cols = everything(),
names_to = "Category",
values_to = "Mean") %>%
mutate(Type = "PST-Level")
) %>%
mutate(reflection = ifelse(grepl("_ref", Category), "PST Reflections", "Supervisor Feedback")) %>%
mutate(
Category = str_remove(Category, "^(overall_|pst_)"),
Category = str_replace_all(Category, "_", " ") %>% str_to_title()
) %>%
mutate(Category = gsub(" Mentioned Feed", "", Category),
Category = gsub(" Mentioned Ref", "", Category),
Category = ifelse(Category=="No Afi", "No Area for Improvement", Category),
Category = ifelse(Category=="Assessment Feedback", "Assessment and Feedback", Category),
Category = factor(Category, levels = c("Other", "Differentiation", "Student Comprehension", "Assessment and Feedback", "Student Engagement", "Communication", "Lesson Planning", "Classroom Management", "No Area for Improvement")))
# Get the desired order based on PST Reflections' mean
category_order <- plot_data_combined %>%
filter(Type == "Observation-Level", reflection == "PST Reflections") %>%
arrange(Mean) %>%
pull(Category)
# Create bar plot
plot_data_combined %>%
filter(Type == "Observation-Level" & Category != "Other") %>%
mutate(Category = factor(Category, levels = category_order)) %>%
ggplot(aes(x = Category, y = Mean, fill = reflection)) +
geom_col(position = "dodge", width = 0.7) +
coord_flip() +
labs(x = NULL, y = "% of Observations", fill = NULL) +
theme_minimal(base_size = 14) +
scale_y_continuous(expand = c(0, 0), limits = c(0, 0.75), labels = scales::percent_format()) +
scale_fill_manual(values = c("PST Reflections" = "#1F4E79", "Supervisor Feedback" = "#FF8C42"), guide = guide_legend(reverse = TRUE)) +
theme(text = element_text(family = "LMRoman", color = "black", size = 16),
plot.caption = element_text(hjust = 0),
axis.text = element_text(color = "black", size = 16),
panel.grid.major.y = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "bottom")
#Plot area for improvement----
plot_data <- analysis_data %>%
mutate(feedback_score = rowMeans(across(c("classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed")), na.rm = TRUE)) %>%
mutate(feedback_score = rowMeans(across(c("classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref")), na.rm = TRUE))
# Calculate overall means
overall_means <- plot_data %>%
summarize(across(c("classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~mean(.x, na.rm = TRUE), .names = "overall_{.col}"))
# Calculate PST-level means (PSTs with at least one occurrence)
pst_means <- plot_data %>%
group_by(pst_id) %>%
summarize(across(c("classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~as.numeric(any(.x == 1, na.rm = TRUE)))) %>%
summarize(across(-pst_id, ~mean(.x, na.rm = TRUE), .names = "pst_{.col}"))
# Combine and reshape data for plotting
plot_data_combined <- bind_rows(
pivot_longer(overall_means,
cols = everything(),
names_to = "Category",
values_to = "Mean") %>%
mutate(Type = "Observation-Level"),
pivot_longer(pst_means,
cols = everything(),
names_to = "Category",
values_to = "Mean") %>%
mutate(Type = "PST-Level")
) %>%
mutate(reflection = ifelse(grepl("_ref", Category), "PST Reflections", "Supervisor Feedback")) %>%
mutate(
Category = str_remove(Category, "^(overall_|pst_)"),
Category = str_replace_all(Category, "_", " ") %>% str_to_title()
) %>%
mutate(Category = gsub(" Mentioned Feed", "", Category),
Category = gsub(" Mentioned Ref", "", Category),
Category = ifelse(Category=="No Afi", "No Area for Improvement", Category),
Category = ifelse(Category=="Assessment Feedback", "Assessment and Feedback", Category),
Category = factor(Category, levels = c("Other", "Differentiation", "Student Comprehension", "Assessment and Feedback", "Student Engagement", "Communication", "Lesson Planning", "Classroom Management", "No Area for Improvement")))
# Get the desired order based on PST Reflections' mean
category_order <- plot_data_combined %>%
filter(Type == "Observation-Level", reflection == "PST Reflections") %>%
arrange(Mean) %>%
pull(Category)
# Create bar plot
plot_data_combined %>%
filter(Type == "Observation-Level" & Category != "Other") %>%
mutate(Category = factor(Category, levels = category_order)) %>%
ggplot(aes(x = Category, y = Mean, fill = reflection)) +
geom_col(position = "dodge", width = 0.7) +
coord_flip() +
labs(x = NULL, y = "% of Observations", fill = NULL) +
theme_minimal(base_size = 14) +
scale_y_continuous(expand = c(0, 0), limits = c(0, 0.75), labels = scales::percent_format()) +
scale_fill_manual(values = c("PST Reflections" = "#1F4E79", "Supervisor Feedback" = "#FF8C42"), guide = guide_legend(reverse = TRUE)) +
theme(text = element_text(family = "LMRoman", color = "black", size = 16),
plot.caption = element_text(hjust = 0),
axis.text = element_text(color = "black", size = 16),
panel.grid.major.y = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "bottom")
plot_data <- analysis_data %>%
mutate(feedback_score = rowMeans(across(c("classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed")), na.rm = TRUE)) %>%
mutate(feedback_score = rowMeans(across(c("classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref")), na.rm = TRUE))
# Calculate overall means
overall_means <- plot_data %>%
summarize(across(c("classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~mean(.x, na.rm = TRUE), .names = "overall_{.col}"))
overall_means
plot_data <- analysis_data %>%
mutate(feedback_score = rowMeans(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed")), na.rm = TRUE)) %>%
mutate(feedback_score = rowMeans(across(c("no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref")), na.rm = TRUE)) %>%
# Make things NA if there's no area for improvement
mutate(across(c("classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed"),
~ifelse(no_afi_mentioned_feed==1, NA, .x)))
# Calculate overall means
overall_means <- plot_data %>%
summarize(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~mean(.x, na.rm = TRUE), .names = "overall_{.col}"))
overall_means
plot_data <- analysis_data %>%
mutate(feedback_score = rowMeans(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed")), na.rm = TRUE)) %>%
mutate(feedback_score = rowMeans(across(c("no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref")), na.rm = TRUE)) %>%
# Make things NA if there's no area for improvement
mutate(across(c("classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed"),
~ifelse(no_afi_mentioned_feed==1, NA, .x)))
# Calculate overall means
overall_means <- plot_data %>%
summarize(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~mean(.x, na.rm = TRUE), .names = "overall_{.col}"))
# Calculate PST-level means (PSTs with at least one occurrence)
pst_means <- plot_data %>%
group_by(pst_id) %>%
summarize(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~as.numeric(any(.x == 1, na.rm = TRUE)))) %>%
summarize(across(-pst_id, ~mean(.x, na.rm = TRUE), .names = "pst_{.col}"))
# Combine and reshape data for plotting
plot_data_combined <- bind_rows(
pivot_longer(overall_means,
cols = everything(),
names_to = "Category",
values_to = "Mean") %>%
mutate(Type = "Observation-Level"),
pivot_longer(pst_means,
cols = everything(),
names_to = "Category",
values_to = "Mean") %>%
mutate(Type = "PST-Level")
) %>%
mutate(reflection = ifelse(grepl("_ref", Category), "PST Reflections", "Supervisor Feedback")) %>%
mutate(
Category = str_remove(Category, "^(overall_|pst_)"),
Category = str_replace_all(Category, "_", " ") %>% str_to_title()
) %>%
mutate(Category = gsub(" Mentioned Feed", "", Category),
Category = gsub(" Mentioned Ref", "", Category),
Category = ifelse(Category=="No Afi", "No Area for Improvement", Category),
Category = ifelse(Category=="Assessment Feedback", "Assessment and Feedback", Category),
Category = factor(Category, levels = c("Other", "Differentiation", "Student Comprehension", "Assessment and Feedback", "Student Engagement", "Communication", "Lesson Planning", "Classroom Management", "No Area for Improvement")))
# Get the desired order based on PST Reflections' mean
category_order <- plot_data_combined %>%
filter(Type == "Observation-Level", reflection == "PST Reflections") %>%
arrange(Mean) %>%
pull(Category)
# Create bar plot
plot_data_combined %>%
filter(Type == "Observation-Level" & Category != "Other") %>%
mutate(Category = factor(Category, levels = category_order)) %>%
ggplot(aes(x = Category, y = Mean, fill = reflection)) +
geom_col(position = "dodge", width = 0.7) +
coord_flip() +
labs(x = NULL, y = "% of Observations", fill = NULL) +
theme_minimal(base_size = 14) +
scale_y_continuous(expand = c(0, 0), limits = c(0, 0.75), labels = scales::percent_format()) +
scale_fill_manual(values = c("PST Reflections" = "#1F4E79", "Supervisor Feedback" = "#FF8C42"), guide = guide_legend(reverse = TRUE)) +
theme(text = element_text(family = "LMRoman", color = "black", size = 16),
plot.caption = element_text(hjust = 0),
axis.text = element_text(color = "black", size = 16),
panel.grid.major.y = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "bottom")
plot_data <- analysis_data %>%
mutate(feedback_score = rowMeans(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed")), na.rm = TRUE)) %>%
mutate(feedback_score = rowMeans(across(c("no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref")), na.rm = TRUE)) %>%
# Make things NA if there's no area for improvement
mutate(across(c("classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed"),
~ifelse(no_afi_mentioned_feed==1, NA, .x))) %>%
mutate(across(c("classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~ifelse(no_afi_mentioned_ref==1, NA, .x)))
# Calculate overall means
overall_means <- plot_data %>%
summarize(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~mean(.x, na.rm = TRUE), .names = "overall_{.col}"))
# Calculate PST-level means (PSTs with at least one occurrence)
pst_means <- plot_data %>%
group_by(pst_id) %>%
summarize(across(c("no_afi_mentioned_feed", "classroom_management_mentioned_feed", "lesson_planning_mentioned_feed", "differentiation_mentioned_feed", "assessment_feedback_mentioned_feed", "student_engagement_mentioned_feed", "student_comprehension_mentioned_feed", "communication_mentioned_feed", "other_mentioned_feed",
"no_afi_mentioned_ref", "classroom_management_mentioned_ref", "lesson_planning_mentioned_ref", "differentiation_mentioned_ref", "assessment_feedback_mentioned_ref", "student_engagement_mentioned_ref", "student_comprehension_mentioned_ref", "communication_mentioned_ref", "other_mentioned_ref"),
~as.numeric(any(.x == 1, na.rm = TRUE)))) %>%
summarize(across(-pst_id, ~mean(.x, na.rm = TRUE), .names = "pst_{.col}"))
# Combine and reshape data for plotting
plot_data_combined <- bind_rows(
pivot_longer(overall_means,
cols = everything(),
names_to = "Category",
values_to = "Mean") %>%
mutate(Type = "Observation-Level"),
pivot_longer(pst_means,
cols = everything(),
names_to = "Category",
values_to = "Mean") %>%
mutate(Type = "PST-Level")
) %>%
mutate(reflection = ifelse(grepl("_ref", Category), "PST Reflections", "Supervisor Feedback")) %>%
mutate(
Category = str_remove(Category, "^(overall_|pst_)"),
Category = str_replace_all(Category, "_", " ") %>% str_to_title()
) %>%
mutate(Category = gsub(" Mentioned Feed", "", Category),
Category = gsub(" Mentioned Ref", "", Category),
Category = ifelse(Category=="No Afi", "No Area for Improvement", Category),
Category = ifelse(Category=="Assessment Feedback", "Assessment and Feedback", Category),
Category = factor(Category, levels = c("Other", "Differentiation", "Student Comprehension", "Assessment and Feedback", "Student Engagement", "Communication", "Lesson Planning", "Classroom Management", "No Area for Improvement")))
# Get the desired order based on PST Reflections' mean
category_order <- plot_data_combined %>%
filter(Type == "Observation-Level", reflection == "PST Reflections") %>%
arrange(Mean) %>%
pull(Category)
# Create bar plot
plot_data_combined %>%
filter(Type == "Observation-Level" & Category != "Other") %>%
mutate(Category = factor(Category, levels = category_order)) %>%
ggplot(aes(x = Category, y = Mean, fill = reflection)) +
geom_col(position = "dodge", width = 0.7) +
coord_flip() +
labs(x = NULL, y = "% of Observations", fill = NULL) +
theme_minimal(base_size = 14) +
scale_y_continuous(expand = c(0, 0), limits = c(0, 0.75), labels = scales::percent_format()) +
scale_fill_manual(values = c("PST Reflections" = "#1F4E79", "Supervisor Feedback" = "#FF8C42"), guide = guide_legend(reverse = TRUE)) +
theme(text = element_text(family = "LMRoman", color = "black", size = 16),
plot.caption = element_text(hjust = 0),
axis.text = element_text(color = "black", size = 16),
panel.grid.major.y = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "bottom")
plot_data_combined %>%
filter(Type == "Observation-Level" & Category != "Other" & Category != "No Area for Improvement") %>%
mutate(Category = factor(Category, levels = category_order)) %>%
ggplot(aes(x = Category, y = Mean, fill = reflection)) +
geom_col(position = "dodge", width = 0.7) +
coord_flip() +
labs(x = NULL, y = "% of Observations", fill = NULL) +
theme_minimal(base_size = 14) +
scale_y_continuous(expand = c(0, 0), limits = c(0, 0.75), labels = scales::percent_format()) +
scale_fill_manual(values = c("PST Reflections" = "#1F4E79", "Supervisor Feedback" = "#FF8C42"), guide = guide_legend(reverse = TRUE)) +
theme(text = element_text(family = "LMRoman", color = "black", size = 16),
plot.caption = element_text(hjust = 0),
axis.text = element_text(color = "black", size = 16),
panel.grid.major.y = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "bottom")
ggsave(file.path(output_path, "Bar Chart Area for Improvement - Observation.pdf"), width = 7, height = 4)
